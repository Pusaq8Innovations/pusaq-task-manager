<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Profile - Pusaq</title>
  <link rel="stylesheet" href="styles/profile.css">
</head>
<body>

  <div class="topbar">
    <img src="pusaq-logo.jpeg" alt="Pusaq Logo" />
    <div class="nav-links">
      <a href="dashboard.html">ðŸ“‹ Dashboard</a>
      <a href="calendar-grid.html">ðŸ“… Calendar</a>
    </div>
  </div>

  <h1>ðŸ‘¤ Your Profile</h1>

  <div class="profile-box">
    <img id="avatar" src="https://via.placeholder.com/100" alt="Profile" />
    <input type="file" id="imageUpload" accept="image/*" />
    <input type="text" id="displayName" placeholder="Your name" />
    <input type="text" id="role" readonly />
    <input type="text" id="password" readonly value="Auto-generated" />
    <textarea id="userComment" placeholder="Floating message for login page..."></textarea>

    <button onclick="saveProfile()">ðŸ’¾ Save Profile</button>
    <button onclick="goToDashboard()">ðŸ“‹ Go to Dashboard</button>
    <button onclick="logout()">ðŸšª Logout</button>
  </div>

  <script src="backend.js"></script>
  <script>
    async function loadProfile() {
      try {
        const user = await AuthAPI.me();

        document.getElementById("displayName").value = user.name;
        document.getElementById("role").value = user.role;
        document.getElementById("userComment").value = localStorage.getItem(`comment_${user.name}`) || "";

        // Puedes integrar carga de avatar si la API lo permite
      } catch (err) {
        console.error("Failed to load user:", err);
        alert("Failed to load profile.");
        window.location.href = "index.html";
      }
    }

    function saveProfile() {
      const name = document.getElementById("displayName").value;
      const comment = document.getElementById("userComment").value;

      const username = localStorage.getItem("user_name");
      if (username) {
        localStorage.setItem(`comment_${username}`, comment);
      }

      alert("âœ… Profile saved! (Note: Name changes are not yet sent to the server.)");
    }

    function goToDashboard() {
      window.location.href = "dashboard.html";
    }

    async function logout() {
      try {
        await AuthAPI.logout();
        window.location.href = "index.html";
      } catch (err) {
        console.error("Logout failed:", err);
        alert("Error during logout.");
      }
    }

    loadProfile();
  </script>
</body>
</html>
