<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Who's working today? - Pusaq</title>
  <link rel="stylesheet" href="styles/index.css">
</head>

<body>

  <div class="logo">
    <img src="pusaq-logo1.jpeg" alt="Pusaq Logo" />
  </div>

  <h1>Who's working today?</h1>

  <div class="user-grid"></div>

  <!-- Floating comments overlay -->
  <div id="floating-comments-container"></div>

  <!-- Funciones de backend -->
  <script src="backend.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        console.log("Cargando usuarios...");
        const users = await UserAPI.getAll();
        console.log("Usuarios cargados:", users);
        renderUsers(users);
      } catch (err) {
        console.error("Error al obtener usuarios:", err);
        alert("No se pudieron cargar los usuarios.");
      }
    });

    function renderUsers(users) {
      const container = document.querySelector(".user-grid");
      container.innerHTML = "";

      users.forEach(user => {
        const div = document.createElement("div");
        div.className = "user-box";
        div.onclick = () => promptPasswordAndLogin(user);

        div.innerHTML = `
          <img src="https://via.placeholder.com/100" alt="${user.name}" />
          <span>${user.name}</span>
        `;

        container.appendChild(div);
      });
    }

    async function promptPasswordAndLogin(user) {
      const password = prompt(`Ingresa la contraseña para ${user.name}:`);
      if (!password) return;

      try {
        const data = await AuthAPI.login(user.email, password);  // Autenticación

        // Verificamos el rol del usuario
        const isAdmin = data.user.role === "admin";

        // Redirigimos dependiendo del rol
        if (isAdmin) {
          window.location.href = "admin.html";  // Redirige a la página del administrador
        } else {
          window.location.href = "dashboard.html";  // Redirige a la página del usuario normal
        }
      } catch (err) {
        console.error("Login error:", err);
        alert("Contraseña incorrecta.");
      }
    }

  </script>

</body>

</html>